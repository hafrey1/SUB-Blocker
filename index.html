<!doctype html>
<html lang="zh-CN">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>订阅节点名称过滤器</title>
	<style>
		body { max-width: 880px; margin: 2rem auto; font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,"Noto Sans SC"; line-height: 1.6; padding: 0 1rem; }
		textarea,input,select,button { width: 100%; box-sizing: border-box; margin: .5rem 0; padding: .6rem .7rem; font-size: 14px; }
		.row { display: grid; grid-template-columns: 1fr 1fr; gap: .75rem; }
		pre { background: #0b1020; color: #e6edf3; padding: 1rem; border-radius: 8px; overflow: auto; min-height: 160px; }
		.actions { display: flex; gap: .75rem; }
		button { cursor: pointer; }
		.hint { color: #666; font-size: 12px; }
	</style>
</head>
<body>
	<h1>订阅节点名称过滤器（GitHub Pages + Cloudflare Workers）</h1>

	<label>原始订阅文本</label>
	<textarea id="raw" rows="8" placeholder="粘贴订阅内容或解码后的节点列表"></textarea>

	<div class="row">
		<div>
			<label>前缀</label>
			<input id="prefix" placeholder="可选，如【自定义】">
		</div>
		<div>
			<label>后缀</label>
			<input id="suffix" placeholder="可选，如 -HK">
		</div>
	</div>

	<div class="row">
		<div>
			<label>语言</label>
			<select id="locale">
				<option value="zh-CN">中文</option>
				<option value="en-US">English</option>
			</select>
		</div>
		<div>
			<label>API 基址</label>
			<input id="apiBase" value="https://sub.527188.xyz" />
		</div>
	</div>

	<div class="actions">
		<button id="convert">转换</button>
		<button id="copy">复制结果</button>
		<button id="clear">清空</button>
	</div>
	<p class="hint">若你的 Workers 需要鉴权，请在代码里设置 x-api-key，或改为 Turnstile/Access 等方案。</p>

	<pre id="output" aria-live="polite">结果会显示在这里</pre>

	<script>
		const $ = (id) => document.getElementById(id);
		const out = $("output");

		$("convert").addEventListener("click", async () => {
			const raw = $("raw").value.trim();
			const prefix = $("prefix").value.trim();
			const suffix = $("suffix").value.trim();
			const locale = $("locale").value;
			const API_BASE = $("apiBase").value.trim() || "https://sub.527188.xyz";
			const API_KEY = ""; // 如需鉴权，在此填入；更安全可使用 Turnstile/Access

			if (!raw) return setOut("请先粘贴原始订阅文本");
			setOut("处理中...");

			const ctrl = new AbortController();
			const timer = setTimeout(() => ctrl.abort(), 15000);

			try {
				const res = await fetch(`${API_BASE}/convert`, {
					method: "POST",
					headers: {
						"Content-Type": "application/json",
						...(API_KEY ? { "x-api-key": API_KEY } : {})
					},
					body: JSON.stringify({ raw, prefix, suffix, locale }),
					signal: ctrl.signal
				});
				clearTimeout(timer);

				const data = await safeJson(res);
				if (!res.ok) throw new Error(data?.error || `HTTP ${res.status}`);
				setOut(`共 ${data.count} 条\n\n${data.result || ""}`);
			} catch (e) {
				setOut(`转换失败：${e.message || e}`);
			}
		});

		$("copy").addEventListener("click", async () => {
			try { await navigator.clipboard.writeText(out.textContent || ""); setOut(out.textContent + "\n\n已复制到剪贴板"); }
			catch { setOut(out.textContent + "\n\n复制失败，请手动选择复制"); }
		});

		$("clear").addEventListener("click", () => { $("raw").value = ""; setOut("结果会显示在这里"); });

		function setOut(text) { out.textContent = text; }
		async function safeJson(res) { try { return await res.json(); } catch { return null; } }
	</script>
</body>
</html>
