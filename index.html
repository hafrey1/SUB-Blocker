<!doctype html>
<html lang="zh-CN">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>订阅节点名称过滤器 · 前端工具</title>
	<style>
		body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin: 24px; line-height: 1.6; }
		h1 { font-size: 20px; }
		.row { margin: 12px 0; }
		input, textarea, select, button { font: inherit; padding: 8px 10px; }
		input, textarea, select { width: 100%; box-sizing: border-box; }
		code, pre { background: #f6f6f6; padding: 10px; border-radius: 6px; overflow: auto; }
		.small { color: #666; font-size: 12px; }
		.grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
		.success { color: #0a7f3f; }
		.error { color: #b00020; }
	</style>
</head>
<body>
	<h1>订阅节点名称过滤器（GitHub Pages + Cloudflare Workers）</h1>

	<div class="row">
		<label>订阅链接（URL）</label>
		<input id="subUrl" placeholder="https://example.com/sub.txt">
		<div class="small">可选。如果 Workers 支持直接拉取原始订阅，这里可不填，只传名称处理参数。</div>
	</div>

	<div class="grid">
		<div>
			<label>包含关键字（逗号分隔）</label>
			<input id="include" placeholder="香港,日本,美国">
		</div>
		<div>
			<label>排除关键字（逗号分隔）</label>
			<input id="exclude" placeholder="游戏,测速,剩余流量">
		</div>
	</div>

	<div class="grid">
		<div>
			<label>前缀</label>
			<input id="prefix" placeholder="[My]">
		</div>
		<div>
			<label>后缀</label>
			<input id="suffix" placeholder="-AUTO">
		</div>
	</div>

	<div class="row">
		<label>地区标识策略</label>
		<select id="region">
			<option value="">不处理</option>
			<option value="emoji">国旗 Emoji</option>
			<option value="iso">ISO 代码</option>
			<option value="cn">中文简称</option>
		</select>
	</div>

	<div class="row">
		<button id="run">生成</button>
		<span id="status" class="small"></span>
	</div>

	<div class="row">
		<label>输出</label>
		<textarea id="output" rows="12" placeholder="处理结果会显示在这里"></textarea>
	</div>

	<script>
	const WORKER_ENDPOINT = "https://sub.527188.xyz"; // 你的 Workers 根地址或具体路由

	function buildQuery(params) {
		const q = new URLSearchParams();
		Object.entries(params).forEach(([k, v]) => {
			if (v !== undefined && v !== null && String(v).trim() !== "") q.set(k, v);
		});
		return q.toString();
	}

	async function callWorker(options) {
		// 假设 Worker 支持 GET 查询参数；若为 POST，请改为 fetch(url,{method:"POST",body:JSON.stringify(...)})
		const query = buildQuery(options);
		const sep = WORKER_ENDPOINT.includes("?") ? "&" : "?";
		const url = WORKER_ENDPOINT + (query ? sep + query : "");
		const res = await fetch(url, {
			method: "GET",
			mode: "cors",
			headers: { "Accept": "text/plain, application/json;q=0.9" },
		});
		// 优先尝试文本，兼容纯文本订阅输出
		const text = await res.text();
		if (!res.ok) {
			throw new Error(`HTTP ${res.status}: ${text.slice(0, 200)}`);
		}
		return text;
	}

	function normalizeCSV(s) {
		return s.split(",").map(x => x.trim()).filter(Boolean).join(",");
	}

	document.getElementById("run").addEventListener("click", async () => {
		const btn = document.getElementById("run");
		const status = document.getElementById("status");
		const output = document.getElementById("output");

		const subUrl = document.getElementById("subUrl").value.trim();
		const include = normalizeCSV(document.getElementById("include").value);
		const exclude = normalizeCSV(document.getElementById("exclude").value);
		const prefix = document.getElementById("prefix").value.trim();
		const suffix = document.getElementById("suffix").value.trim();
		const region = document.getElementById("region").value;

		btn.disabled = true;
		status.textContent = "请求中...";
		status.className = "small";

		try {
			const result = await callWorker({
				url: subUrl,          // 假设 Worker 读取原始订阅的参数名为 url
				include,              // 例如 include=香港,日本
				exclude,              // 例如 exclude=游戏,测速
				prefix,               // 例如 [My]
				suffix,               // 例如 -AUTO
				region,               // emoji | iso | cn
				// 其他你的 Worker 已支持的参数都可以继续拼接
			});
			output.value = result;
			status.textContent = "成功";
			status.className = "small success";
		} catch (e) {
			console.error(e);
			output.value = "";
			status.textContent = "失败：" + e.message;
			status.className = "small error";
		} finally {
			btn.disabled = false;
		}
	});
	</script>
</body>
</html>
